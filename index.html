<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caesar Cipher Wheel Tool</title>
  <link rel="stylesheet" href="style.css" /> <!-- 外部CSSをリンク -->
</head>
<body>
  <h1>Caesar Cipher Wheel Tool</h1>

  <div class="control-panel">
    <textarea id="inputText" rows="3" placeholder="Enter your message here...">hello world.</textarea>
    
    <div class="shift-controls">
      <span class="shift-label">Shift:</span>
      <input type="number" id="shiftNumber" min="0" max="25" value="0" />
      <input type="range" id="shift" min="0" max="25" value="0" />
    </div>

    <div class="mode-controls">
      <label>
        <input type="radio" name="mode" value="encrypt" checked />
        Encrypt
      </label>
      <label>
        <input type="radio" name="mode" value="decrypt" />
        Decrypt
      </label>
    </div>

    <div class="correspondence-toggle">
      <label for="showLines">Show correspondence lines:</label>
      <div class="toggle-switch" id="toggleSwitch">
        <div class="toggle-slider"></div>
      </div>
    </div>
  </div>

  <div class="disk-container">
    <div class="outer-ring-bg"></div>
    <div class="inner-ring-bg"></div>
    <svg class="correspondence-lines hidden" id="correspondenceLines" viewBox="0 0 400 400">
      <!-- Lines will be drawn here -->
    </svg>
    <div class="ring" id="outerRing"></div>
    <div class="ring" id="innerRing"></div>
    <div class="center-circle"></div>
  </div>

  <div class="output-panel">
    <span class="output-label">Result:</span>
    <div id="output"></div>
  </div>

  <div style="margin-top: 30px; padding: 15px; text-align: center; border-top: 1px solid #000000; color: #6c757d;">
    🔗 GitHubリポジトリはこちら（<a href="https://github.com/ipusiron/caesar-cipher-wheel" target="_blank" style="color: #007bff; text-decoration: none;">ipusiron/caesar-cipher-wheel</a>）
  </div>

  <script>
    const alphabet = [..."ABCDEFGHIJKLMNOPQRSTUVWXYZ"];
    const outerRing = document.getElementById("outerRing");
    const innerRing = document.getElementById("innerRing");
    const inputText = document.getElementById("inputText");
    const shiftSlider = document.getElementById("shift");
    const shiftNumber = document.getElementById("shiftNumber");
    const output = document.getElementById("output");
    const correspondenceLines = document.getElementById("correspondenceLines");
    const toggleSwitch = document.getElementById("toggleSwitch");
    let showLines = false;

    function createRing(container, isInner = false) {
      container.innerHTML = "";
      const len = alphabet.length;
      const radius = isInner ? 120 : 170;
      const centerX = 200;
      const centerY = 200;

      alphabet.forEach((char, i) => {
        const angle = (360 / len) * i;
        const angleRad = (angle - 90) * Math.PI / 180;
        const x = centerX + radius * Math.cos(angleRad);
        const y = centerY + radius * Math.sin(angleRad);

        const el = document.createElement("div");
        el.className = `letter ${isInner ? 'inner-letter' : 'outer-letter'}`;
        el.style.left = `${x - 16}px`;
        el.style.top = `${y - 16}px`;
        el.innerText = char;
        
        // Add data attribute for inner letters to track rotation
        if (isInner) {
          el.setAttribute('data-letter', char);
        }
        
        container.appendChild(el);
      });
    }

    function caesarCipher(text, shift, decrypt = false) {
      return text.toUpperCase().replace(/[A-Z]/g, c => {
        const index = alphabet.indexOf(c);
        if (index === -1) return c;
        const offset = decrypt ? (index - shift + 26) % 26 : (index + shift) % 26;
        return alphabet[offset];
      });
    }

    function drawCorrespondenceLines() {
      correspondenceLines.innerHTML = "";
      if (!showLines) return;
      
      const shift = parseInt(shiftSlider.value);
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const isDecrypt = mode === "decrypt";
      const outerRadius = 170;
      const innerRadius = 120;
      const centerX = 200;
      const centerY = 200;
      
      // Inner ring rotation angle (same as in update function)
      const ringRotationAngle = (360 / 26) * shift * (isDecrypt ? 1 : -1);
      
      alphabet.forEach((char, i) => {
        // Outer ring position (plaintext - fixed)
        const outerAngle = (360 / 26) * i - 90;
        const outerX = centerX + outerRadius * Math.cos(outerAngle * Math.PI / 180);
        const outerY = centerY + outerRadius * Math.sin(outerAngle * Math.PI / 180);
        
        // Inner ring position - the physical position of the corresponding letter
        // Find which inner letter corresponds to this outer letter
        const targetIndex = isDecrypt ? (i - shift + 26) % 26 : (i + shift) % 26;
        // But the inner ring is rotated, so we need the original position of that letter
        const innerAngle = (360 / 26) * targetIndex - 90 + ringRotationAngle;
        const innerX = centerX + innerRadius * Math.cos(innerAngle * Math.PI / 180);
        const innerY = centerY + innerRadius * Math.sin(innerAngle * Math.PI / 180);
        
        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", outerX);
        line.setAttribute("y1", outerY);
        line.setAttribute("x2", innerX);
        line.setAttribute("y2", innerY);
        line.setAttribute("stroke", "#e74c3c");
        line.setAttribute("stroke-width", "2");
        line.setAttribute("opacity", "0.7");
        
        correspondenceLines.appendChild(line);
      });
    }

    function toggleLines() {
      showLines = !showLines;
      toggleSwitch.classList.toggle('active', showLines);
      correspondenceLines.classList.toggle('hidden', !showLines);
      drawCorrespondenceLines();
    }

    function update() {
      const shift = parseInt(shiftSlider.value);
      shiftNumber.value = shift;
      const mode = document.querySelector('input[name="mode"]:checked').value;
      const isDecrypt = mode === "decrypt";
      const angle = (360 / 26) * shift * (isDecrypt ? 1 : -1);
      innerRing.style.transform = `rotate(${angle}deg)`;
      
      // Keep inner letters upright
      const innerLetters = innerRing.querySelectorAll('.inner-letter');
      innerLetters.forEach(letter => {
        letter.style.transform = `rotate(${-angle}deg)`;
      });
      
      const text = inputText.value;
      if (text) {
        const result = caesarCipher(text, shift, isDecrypt);
        output.textContent = result;
      } else {
        output.textContent = "Enter text above to see the result";
      }
      
      drawCorrespondenceLines();
    }

    // Event listeners
    shiftSlider.addEventListener("input", () => {
      shiftNumber.value = shiftSlider.value;
      update();
    });

    shiftNumber.addEventListener("input", () => {
      const value = Math.min(25, Math.max(0, parseInt(shiftNumber.value) || 0));
      shiftNumber.value = value;
      shiftSlider.value = value;
      update();
    });

    inputText.addEventListener("input", update);
    document.querySelectorAll('input[name="mode"]').forEach(r => 
      r.addEventListener("change", update)
    );
    
    toggleSwitch.addEventListener("click", toggleLines);

    // Initialize
    createRing(outerRing);
    createRing(innerRing, true);
    update();
  </script>
</body>
</html>
